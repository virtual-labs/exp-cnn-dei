<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CNN Simulation 3: Dense & Classifier</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Courier+Prime:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/sim3.css">
    <!-- Chart.js for Softmax Output -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="app-container-4pane">
        <!-- 1. LEFT PANE: Theory -->
        <aside class="pane-theory glass-panel">
            <header>
                <h1>The Classifier Head</h1>
            </header>
            <div id="theoryContent" class="theory-scroll">
                <h2>Intuitive Explanation</h2>
                <div class="theory-section intro">
                    <p>The <strong>Fully Connected (FC) head</strong> takes everything the CNN has detected and
                        considers it all at once.</p>
                </div>

                <div class="theory-step">
                    <h3>1. Flattening / Pooling</h3>
                    <p>Removes spatial structure, turning feature maps into a single list of evidence.</p>
                </div>

                <div class="theory-step">
                    <h3>2. Global Reasoning</h3>
                    <p>Each neuron asks: <em>“How much do these combined features support a specific idea?”</em> Weights
                        decide which features matter and how strongly they vote.</p>
                </div>

                <div class="theory-step">
                    <h3>3. Logits & Decisions</h3>
                    <p>Logits are raw class evidence; the highest one wins after normalization. Bigger heads can model
                        more complex combinations but are easier to overfit.</p>
                </div>

                <p class="highlight-text" style="margin-top:10px;">In short: the FC head is a global decision-maker that
                    turns extracted features into class scores.</p>
            </div>
            <footer>
                <div style="margin-top:10px;">
                    <a href="simulation2.html" class="nav-btn-back"
                        style="color:#94a3b8; margin-right:10px; text-decoration:none;">⬅ Conv Engine</a>
                    <span style="color:#334155; pointer-events:none;">Next: Backprop ➡</span>
                </div>
            </footer>
        </aside>

        <!-- RIGHT AREA WRAPPER -->
        <div class="right-area-col">

            <!-- 2. TOP PANE: Network Visualization -->
            <section class="pane-stage" id="stagePane">
                <div class="sim-header">
                    <span id="layerTitle">Classification Head (GAP -> Dense -> Softmax)</span>
                    <div class="stage-controls">
                        <div class="param-badge" id="paramCountBadge">Params: 0</div>
                        <button id="btnPredict" class="btn-play">▶ Predict</button>
                    </div>
                </div>

                <div class="fc-visual-container" id="fcVisual">
                    <!-- 
                        Generated by JS:
                        [GAP Input (256)] -> [Dropout] -> [Hidden Layers...] -> [Output (10)]
                     -->
                </div>
            </section>

            <!-- 3. BOTTOM SPLIT (Controls | Math) -->
            <section class="pane-bottom-split">

                <!-- BOTTOM LEFT: Controls -->
                <div class="pane-controls glass-panel">
                    <h3>Configuration <span class="badge">Modern Head</span></h3>

                    <div class="controls-grid">
                        <!-- Input Selection -->
                        <div class="c-group">
                            <label>Input Feature Map</label>
                            <select id="classSelect">
                                <option value="car">Car (Valid Features)</option>
                                <option value="dog">Dog (Fur, Snout)</option>
                                <option value="plane">Plane (Wings, Sky)</option>
                                <option value="noise">Random Noise</option>
                            </select>
                        </div>

                        <!-- Architecture Controls -->
                        <div class="c-group box-border">
                            <label>Architecture</label>
                            <div class="btn-group-row">
                                <button id="btnAddLayer" class="btn-secondary" title="Add Hidden Layer">+ Layer</button>
                                <button id="btnRemLayer" class="btn-secondary" title="Remove Hidden Layer">-
                                    Layer</button>
                            </div>
                            <div class="slider-row">
                                <span>Hidden Units: <strong id="valNeurons">12</strong></span>
                                <input type="range" id="sldNeurons" min="4" max="32" value="12">
                            </div>
                        </div>

                        <!-- Hyperparameters -->
                        <div class="c-group box-border">
                            <label>Hyperparameters</label>
                            <div class="slider-row">
                                <span>Dropout: <strong id="valDropout">0.38</strong></span>
                                <input type="range" id="sldDropout" min="0" max="0.9" step="0.05" value="0.38">
                            </div>
                            <div class="btn-group-row mt-1">
                                <button class="btn-act active" data-act="relu">ReLU</button>
                                <button class="btn-act" data-act="sigmoid">Sigmoid</button>
                                <button class="btn-act" data-act="tanh">Tanh</button>
                            </div>
                        </div>

                        <div class="c-group">
                            <label>Weights</label>
                            <div class="btn-group-row">
                                <button id="btnInitRandom" class="btn-secondary">Random</button>
                                <button id="btnPreTrained" class="btn-primary active">Pre-Trained</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- BOTTOM RIGHT: Math Engine -->
                <div class="pane-math glass-panel">
                    <h3>Math: Dense Layer</h3>
                    <div class="math-content">
                        <div class="math-eq-general">
                            <span class="math-var">a</span><sup>[l]</sup> = <span class="math-func">g</span>( <span
                                class="math-var">W</span><sup>[l]</sup> <span class="math-var">a</span><sup>[l-1]</sup>
                            + <span class="math-var">b</span><sup>[l]</sup> )
                        </div>
                        <div id="mathDetail" class="math-detail-box">
                            <p class="text-muted">Hover over nodes or lines to see the logic.</p>
                            <ul style="padding-left:15px; margin-top:5px; font-size:0.8rem;">
                                <li><strong>GAP:</strong> 256 spatial maps averaged to 1 value each.</li>
                                <li><strong>Dropout:</strong> Randomly zeros out neurons during training.</li>
                                <li><strong>Linear:</strong> Weighted sum of all inputs.</li>
                            </ul>
                        </div>
                    </div>
                </div>

            </section>
        </div>
    </div>
    <script src="js/sim3.js"></script>
</body>

</html>