:root {
    --bg-color: #ffffff;
    --text-color: #333333;
    --primary-color: #0d6efd;
    /* accent-blue from reference */
    --primary-hover: #0a58ca;
    /* accent-blue-dark */
    --secondary-color: #f8f9fa;
    /* bg-secondary */
    --border-color: #dee2e6;
    --code-bg: #f8fafc;
    --sidebar-width: 260px;
    --cell-max-width: 900px;
    --font-main: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif;
    --font-mono: 'JetBrains Mono', 'Fira Code', monospace;

    /* Reference Theme Colors */
    --text-primary: #212529;
    --text-secondary: #495057;
    --text-muted: #6c757d;

    --bg-primary: #ffffff;
    --bg-secondary: #f8f9fa;
    --bg-tertiary: #e9ecef;

    --accent-blue: #0d6efd;
    --accent-green: #198754;
    --accent-yellow: #ffc107;
    --accent-red: #dc3545;

    /* Step States */
    --step-pending: #adb5bd;
    --step-ready: #0d6efd;
    --step-running: #ffc107;
    --step-completed: #198754;
    --step-error: #dc3545;

    /* Shadows */
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);

    /* Spacing */
    --spacing-xs: 4px;
    --spacing-sm: 8px;
    --spacing-md: 16px;
    --spacing-lg: 24px;
    --spacing-xl: 32px;

    /* Border Radius */
    --radius-sm: 4px;
    --radius-md: 8px;
    --radius-lg: 12px;

    /* Transitions */
    --transition-fast: 0.15s ease;
    --transition-normal: 0.3s ease;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: var(--font-main);
    background-color: var(--bg-color);
    color: var(--text-color);
    display: flex;
    min-height: 100vh;
}

/* Step Sidebar */
.step-sidebar {
    width: var(--sidebar-width);
    background: var(--bg-secondary);
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    position: fixed;
    left: 0;
    top: 0;
    bottom: 0;
    z-index: 100;
    overflow-y: auto;
    box-shadow: var(--shadow-sm);
}

.step-sidebar-header {
    padding: var(--spacing-lg);
    border-bottom: 1px solid var(--border-color);
    background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
}

.step-sidebar-header h3 {
    font-size: 1rem;
    font-weight: 600;
    color: #ffffff;
    letter-spacing: 0.3px;
    margin: 0;
}

.step-list {
    flex: 1;
    padding: var(--spacing-md);
    overflow-y: auto;
}

.step-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
    border-radius: var(--radius-md);
    background: var(--bg-primary);
    border: 1px solid var(--border-light);
    /* Fallback or define var */
    border-color: #e9ecef;
    cursor: pointer;
    transition: all var(--transition-normal);
    box-shadow: var(--shadow-sm);
}

.step-item:hover {
    border-color: var(--accent-blue);
    transform: translateX(4px);
    box-shadow: var(--shadow-md);
}

.step-item.active {
    border-color: var(--step-ready);
    background: rgba(13, 110, 253, 0.05);
    box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.15);
}

.step-item.running {
    border-color: var(--step-running);
    background: rgba(255, 193, 7, 0.1);
}

.step-item.running .step-indicator {
    animation: pulse 1.5s infinite;
}

.step-item.completed {
    border-color: var(--step-completed);
    background: rgba(25, 135, 84, 0.05);
}

.step-indicator {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-tertiary);
    border: 2px solid var(--step-pending);
    transition: all var(--transition-normal);
    flex-shrink: 0;
}

.step-item.active .step-indicator {
    border-color: var(--step-ready);
    background: var(--step-ready);
}

.step-item.running .step-indicator {
    border-color: var(--step-running);
    background: var(--step-running);
}

.step-item.completed .step-indicator {
    border-color: var(--step-completed);
    background: var(--step-completed);
}

.step-number {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-muted);
    transition: color var(--transition-normal);
}

.step-item.active .step-number,
.step-item.running .step-number,
.step-item.completed .step-number {
    color: #ffffff;
}

.step-item.completed .step-number::after {
    content: 'âœ“';
    font-size: 0.875rem;
}

.step-item.completed .step-number {
    font-size: 0;
    /* Hide number */
}

.step-title {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text-secondary);
    transition: color var(--transition-normal);
}

.step-item.active .step-title {
    color: var(--accent-blue);
    font-weight: 600;
}

.step-item.running .step-title {
    color: var(--text-primary);
    font-weight: 600;
}

.step-item.completed .step-title {
    color: var(--step-completed);
}

/* Sidebar Footer */
.step-sidebar-footer {
    padding: var(--spacing-md);
    border-top: 1px solid var(--border-color);
    background: var(--bg-primary);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
}

.run-all-btn,
.reset-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-md);
    border: none;
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-normal);
    width: 100%;
    /* Full width in footer */
}

.run-all-btn {
    background: linear-gradient(135deg, #198754 0%, #157347 100%);
    color: #ffffff;
    box-shadow: var(--shadow-sm);
}

.run-all-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(25, 135, 84, 0.35);
}

.run-all-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.reset-btn {
    background: var(--bg-tertiary);
    color: var(--text-secondary);
    border: 1px solid var(--border-color);
}

.reset-btn:hover {
    background: var(--bg-secondary);
    color: var(--text-primary);
    border-color: var(--text-muted);
}

.status-panel {
    /* Optional: Hide or integrate status panel into footer if needed. 
       For now, let's keep it styled minimally or hidden if not used in reference,
       but the JS might define it. Reference doesn't seem to have a status panel like this.
       We can style it to fit.
    */
    padding: 0 var(--spacing-md) var(--spacing-md);
    font-size: 0.8rem;
}

.progress-bar-container {
    background-color: var(--bg-tertiary);
    height: 4px;
    border-radius: 2px;
    overflow: hidden;
    margin-top: 4px;
}

.progress-bar {
    background-color: var(--accent-blue);
    height: 100%;
    width: 0%;
    transition: width 0.3s ease;
}

/* Main Content */
.notebook-container {
    margin-left: var(--sidebar-width);
    padding: 3rem 4rem;
    flex: 1;
    max-width: calc(100% - var(--sidebar-width));
    overflow-y: auto;
}

.cell {
    max-width: var(--cell-max-width);
    margin: 0 auto 2rem;
    background: white;
    border: 1px solid transparent;
    border-radius: 8px;
    padding: 0;
    /* Control padding in children */
    position: relative;
    transition: box-shadow 0.2s;
}

.cell:hover {
    /* Subtle lift for focus */
    /* box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); */
}

/* Markdown Cells */
.cell.markdown {
    padding: 1rem 1.5rem;
}

.cell.markdown h1,
.cell.markdown h2,
.cell.markdown h3 {
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
    color: #111;
}

.cell.markdown p {
    margin-bottom: 1rem;
    line-height: 1.7;
    color: #374151;
}

/* ---------------------------
   4. Code Cells (Dark Theme)
--------------------------- */
.cell.code {
    border: 1px solid var(--border-color);
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

.input-area {
    background-color: #282c34;
    /* Atom One Dark background */
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border-color);
    font-family: var(--font-mono);
    font-size: 0.95rem;
    position: relative;
    color: #abb2bf;
    /* Atom One Dark text */
    overflow-x: auto;
    /* Horizontal scroll fix */
}

/* Run Button */
.run-cell-btn {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    background: #333;
    border: 1px solid #555;
    color: #e5e7eb;
    width: 32px;
    height: 32px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    opacity: 0.8;
    transition: all 0.2s;
    z-index: 10;
}

.cell.code:hover .run-cell-btn {
    opacity: 1;
}

.run-cell-btn:hover {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
}

.run-cell-btn:disabled {
    cursor: not-allowed;
    background-color: #2a2a2a;
    border-color: #444;
    color: #666;
    opacity: 0.5;
}

/* Code Highlighting Overrides for Dark Theme */
pre code.hljs {
    padding: 0;
    background: transparent;
    font-size: 0.9rem;
    line-height: 1.5;
    color: inherit;
}

/* Execution Indicator ([ ]) */
.exec-count {
    font-family: var(--font-mono);
    font-size: 0.8rem;
    color: #9ca3af;
    position: absolute;
    top: 1.1rem;
    left: -2.5rem;
    width: 2rem;
    text-align: right;
    user-select: none;
}

.cell.code {
    margin-left: 2.5rem;
}

.cell.markdown {
    margin-left: 2.5rem;
}

/* ---------------------------
   5. Output Area
--------------------------- */
.output-area {
    background-color: #ffffff;
    /* Contrast: White output area */
    border-top: 1px solid var(--border-color);
    padding: 1.5rem;
    font-family: var(--font-mono);
    font-size: 0.9rem;
    display: none;
}

.output-area.visible {
    display: block;
    animation: fadeIn 0.3s;
}

.output-text {
    white-space: pre-wrap;
    color: #1f2937;
    margin-bottom: 0.5rem;
    max-height: 400px;
    /* Limit height */
    overflow-y: auto;
    font-size: 0.85rem;
    line-height: 1.4;
}

.output-image {
    text-align: center;
    overflow-x: auto;
}

.output-image img {
    max-width: 100%;
    border-radius: 4px;
    margin-top: 0.5rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

/* ---------------------------
   6. Table of Contents (TOC)
--------------------------- */
.toc-list {
    flex: 1;
    overflow-y: auto;
    padding-right: 0.5rem;
    margin-bottom: 1rem;
    border-top: 1px solid var(--border-color);
    border-bottom: 1px solid var(--border-color);
    padding-top: 1rem;
}

.toc-item {
    font-size: 0.85rem;
    color: #555;
    padding: 0.4rem 0.6rem;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: background 0.2s, color 0.2s;
    line-height: 1.3;
}

.toc-item:hover {
    background-color: #eee;
    color: #111;
}

.toc-item.active {
    background-color: #e0e7ff;
    color: var(--primary-color);
    font-weight: 600;
}

/* Indentation based on header level */
.toc-item.h1 {
    margin-left: 0;
    font-weight: 700;
    margin-top: 0.5rem;
}

.toc-item.h2 {
    margin-left: 0.5rem;
    font-weight: 600;
}

.toc-item.h3 {
    margin-left: 1.2rem;
}

/* Status Indicators in TOC */
.toc-status {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: #d1d5db;
    /* Pending (grey) */
    flex-shrink: 0;
}

.toc-status.completed {
    background-color: #10b981;
    /* Green */
}

.toc-status.running {
    background-color: var(--primary-color);
    /* Blue */
    animation: pulse 1.5s infinite;
}

/* Animations */
@keyframes pulse {

    0%,
    100% {
        transform: scale(1);
    }

    50% {
        transform: scale(1.1);
    }
}

/* ---------------------------
   7. Loading / Running States
--------------------------- */
.cell.running .run-cell-btn {
    opacity: 1;
    pointer-events: none;
    background-color: transparent;
    color: transparent;
    border: none;
}

.cell.running .run-cell-btn::after {
    content: "";
    position: absolute;
    width: 16px;
    height: 16px;
    border: 2px solid #666;
    /* Visible on dark bg */
    border-top-color: var(--primary-color);
    border-radius: 50%;
    animation: spin 0.6s linear infinite;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(5px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.loading-spinner {
    text-align: center;
    color: #666;
    margin-top: 4rem;
}

/* ---------------------------
   8. Responsive Layout
--------------------------- */
@media (max-width: 1024px) {
    :root {
        --sidebar-width: 240px;
        --cell-max-width: 100%;
    }

    .notebook-container {
        padding: 2rem;
    }
}

@media (max-width: 768px) {
    body {
        flex-direction: column;
    }

    .sidebar {
        width: 100%;
        height: auto;
        position: relative;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
        padding: 1rem;
        gap: 1rem;
    }

    .toc-list {
        display: none;
        /* Hide TOC on mobile to save space, or make collapsible */
    }

    .notebook-container {
        margin-left: 0;
        padding: 1.5rem;
        max-width: 100%;
    }

    .cell.code,
    .cell.markdown {
        margin-left: 0;
        /* Remove indent on mobile */
    }

    .exec-count {
        position: static;
        text-align: left;
        margin-bottom: 0.25rem;
        font-size: 0.75rem;
        width: auto;
    }
}